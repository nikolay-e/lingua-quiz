apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: lingua-quiz
  namespace: preview-pr-{PR_NUMBER}
spec:
  interval: 5m
  chart:
    spec:
      chart: ./helm/lingua-quiz-app
      sourceRef:
        kind: GitRepository
        name: flux-system
        namespace: flux-system
      interval: 1m
      valuesFiles:
        - helm/lingua-quiz-app/values.yaml
        - helm/lingua-quiz-app/values.preview-pr-{PR_NUMBER}.yaml
  values:
    registry: ghcr.io/nikolay-e/lingua-quiz
    imagePullSecrets:
      - name: ghcr-secret
    backend:
      image:
        tag: pr-{PR_NUMBER}-placeholder # {"$imagepolicy": "preview-pr-{PR_NUMBER}:backend"}
    frontend:
      image:
        tag: pr-{PR_NUMBER}-placeholder # {"$imagepolicy": "preview-pr-{PR_NUMBER}:frontend"}
  valuesFrom:
    - kind: Secret
      name: lingua-quiz-sops-values
      valuesKey: values.yaml
