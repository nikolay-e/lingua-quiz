{{- if .Values.ingress.enabled -}}
{{- $fullName := include "lingua-quiz-app.fullname" . -}}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{$fullName}}
  namespace: {{include "lingua-quiz-app.namespace" .}}
  labels:
    {{- include "lingua-quiz-app.labels" . | nindent 4}}
  {{- with .Values.ingress.annotations}}
  annotations:
    {{- toYaml . | nindent 4}}
  {{- end}}
spec:
  {{- if .Values.ingress.className}}
  ingressClassName: {{.Values.ingress.className}}
  {{- end}}
  {{- if and .Values.ingress.tls .Values.ingress.tls.enabled}}
  tls:
    - hosts:
        - {{.Values.ingress.frontend.host | quote}}
        {{- if .Values.ingress.backend.host }}
        - {{.Values.ingress.backend.host | quote}}
        {{- end }}
      secretName: {{.Values.ingress.tls.secretName}}
  {{- end}}
  rules:
    - host: {{.Values.ingress.frontend.host | quote}}
      http:
        paths:
          {{- if not .Values.ingress.backend.host }}
          # API routes go to backend (same host)
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: {{ include "lingua-quiz-app.component.fullname" (dict "root" . "component" (dict "name" "backend")) }}
                port:
                  number: {{.Values.backend.service.port}}
          {{- end }}
          # All other routes go to frontend
          - path: /
            pathType: Prefix
            backend:
              service:
                name: {{ include "lingua-quiz-app.component.fullname" (dict "root" . "component" (dict "name" "frontend")) }}
                port:
                  number: {{.Values.frontend.service.port}}
    {{- if .Values.ingress.backend.host }}
    # Separate backend host
    - host: {{.Values.ingress.backend.host | quote}}
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: {{ include "lingua-quiz-app.component.fullname" (dict "root" . "component" (dict "name" "backend")) }}
                port:
                  number: {{.Values.backend.service.port}}
    {{- end }}
{{- end}}
